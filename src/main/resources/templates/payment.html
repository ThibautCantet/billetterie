<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire de Paiement</title>
</head>
<body>
    <h1>Formulaire de Paiement</h1>
    <span id="error" style="display:none" class="red">Une erreur est survenue lors du paiement</span>
    <form >
        <label for="cartId">ID du Panier :</label>
        <input type="text" id="cartId" name="cartId" required>
        <br><br>
        <label for="amount">Montant (€) :</label>
        <input type="number" id="amount" name="amount" step="0.01" required>
        <br><br>
        <label for="cardNumber">Numéro de la carte :</label>
        <input type="number" id="cardNumber" name="cardNumber" step="0.01" required>
        <br><br>
        <label for="expirationDate">Date d'expiration :</label>
        <input type="text" id="expirationDate" name="expirationDate" step="0.01" required>
        <br><br>
        <label for="cypher">Cryptogramme :</label>
        <input type="number" id="cypher" name="cypher" step="0.01" required>
        <br><br>
        <button type="button" onclick="submitPayment()">Payer</button>
    </form>

    <script>
        async function submitPayment() {
            const cartId = document.getElementById('cartId').value;
            const amount = document.getElementById('amount').value;
            const cardNumber = document.getElementById('cardNumber').value;
            const expirationDate = document.getElementById('expirationDate').value;
            const cypher = document.getElementById('cypher').value;

            const paymentData = {
                cartDto: { id: cartId, amount: parseFloat(amount) },
                creditCardDto: { number: cardNumber, expirationDate: expirationDate, cypher: cypher }
            };

            try {
                const response = await fetch('/api/payment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(paymentData)
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.redirectUrl) {
                        window.location.href = result.redirectUrl;
                    } else {
                        document.getElementById('error').style.display = 'block';
                    }
                } else {
                    alert('Erreur lors de l\'appel API.');
                }
            } catch (error) {
                console.error('Erreur :', error);
                alert('Une erreur est survenue.');
            }
        }
    </script>
</body>
</html>
